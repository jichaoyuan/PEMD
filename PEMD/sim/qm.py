"""Polymer model building tools.Developed by: Tan ShendongDate: 2024.01.18"""import osimport timefrom rdkit import Chemfrom rdkit.Chem import AllChemfrom simple_slurm import Slurmfrom PEMD import PEMD_libclass conformation_search:    def __init__(self, mol, unit_name, out_dir, ln, numconf=10):        self.unit_name = unit_name        self.mol = mol        self.out_dir = out_dir        self.ln = ln        self.numconf = numconf    def run(self):        mol2 = Chem.AddHs(self.mol)        NAttempt = 100000        cids = []        for i in range(10):            cids = AllChem.EmbedMultipleConfs(                mol2,                numConfs=10,                numThreads=64,                randomSeed=i,                maxAttempts=NAttempt,            )            if len(cids) > 0:                break        cid = cids[0]        AllChem.UFFOptimizeMolecule(mol2, confId=cid)        file_base = '{}_N{}'.format(self.unit_name, self.ln)        pdb_file = os.path.join(self.out_dir, file_base + '.pdb')        xyz_file = os.path.join(self.out_dir, file_base + '.xyz')        Chem.MolToPDBFile(mol2, pdb_file, confId=cid)        Chem.MolToXYZFile(mol2, xyz_file, confId=cid)        crest_dir = os.path.join(self.out_dir, file_base, 'crest_work')        os.makedirs(crest_dir, exist_ok=True)        origin_dir = os.getcwd()        os.chdir(crest_dir)        xyz_file_path = os.path.join(origin_dir, xyz_file)        slurm = Slurm(J='crest', N=1, n=32, output=f'slurm.{Slurm.JOB_ARRAY_MASTER_ID}.out')        job_id = slurm.sbatch(f'crest {xyz_file_path} --gfn2 --T 32 --niceprint')        while True:            status = PEMD_lib.get_slurm_job_status(job_id)            if status in ['COMPLETED', 'FAILED', 'CANCELLED']:                print("crest finish, executing the gaussian task...")                lowest_energy_structures = PEMD_lib.crest_lowest_energy_str('crest_conformers.xyz', self.numconf)                os.chdir(origin_dir)                PEMD_lib.save_structures(lowest_energy_structures, self.unit_name, self.ln)                break            else:                print("crest conformer search not finish, waiting...")                time.sleep(30)